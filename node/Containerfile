FROM node:alpine

# Install dependencies
RUN apk add --no-cache tini \
    && corepack enable \
    && corepack prepare pnpm@latest --activate

# Switch to the built‑in non‑root `node` user (UID/GID 1000)
USER node
WORKDIR /workspace

# Development environment variables
ENV HOST=0.0.0.0 \
    NODE_ENV=development \
    CHOKIDAR_USEPOLLING=true \
    PNPM_STORE_PATH=/home/node/.pnpm-store

# Expose common development ports
# - 3000: Next.js default
# - 5173: Vite/SvelteKit default
# - 8080: Fallback alternative
# - 24678: HMR websocket
EXPOSE 3000 5173 8080 24678

# Use tini as init process to reap zombies
ENTRYPOINT ["/sbin/tini", "-s", "--"]

# Default command
CMD ["sh", "-c", "pnpm install && pnpm dev --host 0.0.0.0"]